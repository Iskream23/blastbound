var e=Object.defineProperty,t=(t,s,i)=>((t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i)(t,"symbol"!=typeof s?s+"":s,i);import{r as s,g as i}from"./phaser-CLYd3JIB.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var r=s();const a=i(r);class n extends r.Scene{constructor(){super("Boot")}preload(){this.load.font("PressStart2P","assets/fonts/PressStart2P-Regular.ttf","truetype"),this.load.image("background","assets/bg.png")}create(){this.scene.start("Preloader")}}class o extends r.Scene{constructor(){super("GameOver"),t(this,"camera"),t(this,"background"),t(this,"gameover_text"),t(this,"instructions")}create(){this.camera=this.cameras.main,this.camera.setBackgroundColor(16711680),this.background=this.add.image(0,0,"background"),this.background.setAlpha(.5);const e=this.scale.width/2,t=this.scale.height/2;this.gameover_text=this.add.text(e,t-16,"Game Over",{fontFamily:"PressStart2P",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center"}),this.gameover_text.setOrigin(.5),this.instructions=this.add.text(e,t+20,"Press spacebar",{fontFamily:"PressStart2P",fontSize:8,color:"#FFFFFF",align:"center"}).setOrigin(.5),this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE).once("down",(()=>{this.scene.start("MainMenu")}))}}class h extends a.GameObjects.Sprite{constructor(e,s,i){super(e,16*s+8,16*i+8,"player"),t(this,"gridX"),t(this,"gridY"),t(this,"explosionTimer",3e3),t(this,"explosionRange",2),t(this,"hasExploded",!1),e.add.existing(this),this.gridX=s,this.gridY=i,e.anims.exists("bomb-pulse")||e.anims.create({key:"bomb-pulse",frames:e.anims.generateFrameNumbers("player",{start:79,end:79}),frameRate:2,repeat:-1}),this.play("bomb-pulse"),e.tweens.add({targets:this,scale:{from:1,to:1.2},duration:300,yoyo:!0,repeat:-1}),e.time.delayedCall(this.explosionTimer,(()=>{this.explode()}))}explode(){if(!this.hasExploded){this.hasExploded=!0,this.createExplosion(this.gridX,this.gridY);for(let e=1;e<=this.explosionRange&&this.checkExplosionPath(this.gridX+e,this.gridY);e++)this.createExplosion(this.gridX+e,this.gridY);for(let e=1;e<=this.explosionRange&&this.checkExplosionPath(this.gridX-e,this.gridY);e++)this.createExplosion(this.gridX-e,this.gridY);for(let e=1;e<=this.explosionRange&&this.checkExplosionPath(this.gridX,this.gridY+e);e++)this.createExplosion(this.gridX,this.gridY+e);for(let e=1;e<=this.explosionRange&&this.checkExplosionPath(this.gridX,this.gridY-e);e++)this.createExplosion(this.gridX,this.gridY-e);this.scene.events.emit("bomb-exploded",this.gridX,this.gridY,this.explosionRange),this.destroy()}}checkExplosionPath(e,t){const s=this.scene.level,i=s.getTileAt(e,t),r=s.getCrateAt(e,t);return r?(this.destroyCrate(r),!1):1===i}destroyCrate(e){const t=this.scene.level;e.destroy(),t.removeCrate(e),this.scene.events.emit("crate-destroyed",e.getGridX(),e.getGridY())}createExplosion(e,t){const s=16*e+8,i=16*t+8,r=this.scene.add.sprite(s,i,"player",77);this.scene.tweens.add({targets:r,scale:{from:.5,to:1.5},alpha:{from:1,to:0},duration:500,onComplete:()=>{r.destroy()}});const a=this.scene.level.getCrateAt(e,t);a&&this.destroyCrate(a);const n=this.scene.player;n&&n.getGridX()===e&&n.getGridY()===t&&this.scene.events.emit("player-hit");const o=this.scene.enemies;o&&o.forEach((s=>{s&&s.getGridX()===e&&s.getGridY()===t&&this.scene.events.emit("enemy-hit",s)}))}getGridX(){return this.gridX}getGridY(){return this.gridY}}class l extends a.GameObjects.Sprite{constructor(e,s,i,r){var n,o;super(e,16*s+8,16*i+8,"player"),t(this,"gridX"),t(this,"gridY"),t(this,"isMoving",!1),t(this,"cursors"),t(this,"levelData"),t(this,"spaceKey"),t(this,"bombs",[]),t(this,"maxBombs",1),e.add.existing(this),this.gridX=s,this.gridY=i,this.levelData=r,this.cursors=null==(n=e.input.keyboard)?void 0:n.createCursorKeys(),this.spaceKey=null==(o=e.input.keyboard)?void 0:o.addKey(a.Input.Keyboard.KeyCodes.SPACE),this.createAnim(this.scene,"idle-top",60,60),this.createAnim(this.scene,"walking-top",68,69),this.createAnim(this.scene,"idle-down",61,61),this.createAnim(this.scene,"walking-down",62,63),this.createAnim(this.scene,"walking-right",65,66),this.play("idle-down")}update(){if(this.isMoving)return;a.Input.Keyboard.JustDown(this.spaceKey)&&(console.log("bomb placed"),this.placeBomb());let e=this.gridX,t=this.gridY;if(this.cursors.left.isDown)this.play("walking-right"),this.setFlipX(!0),e--;else if(this.cursors.right.isDown)this.play("walking-right"),this.setFlipX(!1),e++;else if(this.cursors.up.isDown)this.play("walking-top"),t--;else{if(!this.cursors.down.isDown)return;this.play("walking-down"),t++}this.canMoveTo(e,t)&&this.moveToGrid(e,t)}createAnim(e,t,s,i){e.anims.exists(t)||e.anims.create({key:t,frames:e.anims.generateFrameNumbers("player",{start:s,end:i}),frameRate:10,repeat:1})}canMoveTo(e,t){if(e<0||e>=this.levelData[0].length||t<0||t>=this.levelData.length)return!1;const s=this.levelData[t][e],i=this.bombs.some((s=>s.getGridX()===e&&s.getGridY()===t)),r=this.scene.level.hasCrateAt(e,t);return 1===s&&!i&&!r}moveToGrid(e,t){this.isMoving=!0,this.gridX=e,this.gridY=t;const s=16*e+8,i=16*t+8;this.scene.tweens.add({targets:this,x:s,y:i,duration:150,ease:"Power2",onComplete:()=>{this.isMoving=!1}})}placeBomb(){if(!(this.bombs.length>=this.maxBombs||this.bombs.some((e=>e.getGridX()===this.gridX&&e.getGridY()===this.gridY)))){const e=new h(this.scene,this.gridX,this.gridY);this.bombs.push(e)}}removeBomb(e,t){this.bombs=this.bombs.filter((s=>!(s.getGridX()===e&&s.getGridY()===t)))}getGridX(){return this.gridX}getGridY(){return this.gridY}getBombs(){return this.bombs}}class d extends a.GameObjects.Sprite{constructor(e,s,i){super(e,16*s+8,16*i+8,"player",9),t(this,"gridX"),t(this,"gridY"),e.add.existing(this),this.gridX=s,this.gridY=i}destroy(){this.scene.tweens.add({targets:this,scale:{from:1,to:0},alpha:{from:1,to:0},angle:{from:this.angle,to:this.angle+180},duration:300,ease:"Power2.easeIn",onComplete:()=>{this.addDestructionEffect()}})}addDestructionEffect(){const e=[13789470,9127187,10506797];for(let t=0;t<4;t++){const t=this.scene.add.rectangle(this.x+8*(Math.random()-.5),this.y+8*(Math.random()-.5),8,8,e[Math.floor(Math.random()*e.length)]);this.scene.tweens.add({targets:t,x:t.x+30*(Math.random()-.5),y:t.y+30*(Math.random()-.5),alpha:{from:1,to:0},scale:{from:1,to:0},duration:1e3+200*Math.random(),ease:"Power2.easeOut",onComplete:()=>{super.destroy(),t.destroy()}})}}getGridX(){return this.gridX}getGridY(){return this.gridY}}class c{constructor(e,s){t(this,"scene"),t(this,"crates",[]),t(this,"levelData"),t(this,"levelConfig"),t(this,"map",null),t(this,"layer",null),this.scene=e,this.levelConfig=s,this.levelData=s.data.map((e=>[...e]))}create(){this.crates.forEach((e=>e.destroy())),this.crates=[],this.layer&&this.layer.destroy(),this.map&&this.map.destroy(),this.map=this.scene.make.tilemap({data:this.levelData,tileWidth:16,tileHeight:16});const e=this.map.addTilesetImage("tiles");if(e){this.layer=this.map.createLayer(0,e,0,0);for(let e=0;e<this.levelData.length;e++)for(let t=0;t<this.levelData[e].length;t++)if(2===this.levelData[e][t]){const s=new d(this.scene,t,e);this.crates.push(s)}}else console.error("Failed to load tileset!")}getLevelConfig(){return this.levelConfig}getLevelData(){return this.levelData}getWidth(){return this.levelData[0].length}getHeight(){return this.levelData.length}getTileAt(e,t){return t>=0&&t<this.levelData.length&&e>=0&&e<this.levelData[t].length?this.levelData[t][e]:-1}getCrateAt(e,t){return this.crates.find((s=>s.getGridX()===e&&s.getGridY()===t))}removeCrate(e){const t=this.crates.indexOf(e);t>-1&&(this.crates.splice(t,1),this.levelData[e.getGridY()][e.getGridX()]=1,this.layer&&this.layer.putTileAt(1,e.getGridX(),e.getGridY()))}hasCrateAt(e,t){return this.crates.some((s=>s.getGridX()===e&&s.getGridY()===t))}getCrates(){return this.crates}}class g extends a.GameObjects.Sprite{constructor(e,s,i,r,a="horizontal"){super(e,16*s+8,16*i+8,"enemy"),t(this,"gridX"),t(this,"gridY"),t(this,"isMoving",!1),t(this,"levelData"),t(this,"moveDirection"),t(this,"currentDirection",1),t(this,"moveTimer"),t(this,"moveDelay",1e3),t(this,"moveTween",null),e.add.existing(this),this.gridX=s,this.gridY=i,this.levelData=r,this.moveDirection=a,this.createAnim(this.scene,"enemy-idle",16,16),this.play("enemy-idle"),this.moveTimer=this.scene.time.addEvent({delay:this.moveDelay,callback:this.attemptMove,callbackScope:this,loop:!0})}createAnim(e,t,s,i){e.anims.exists(t)||e.anims.create({key:t,frames:e.anims.generateFrameNumbers("enemy",{start:s,end:i}),frameRate:8,repeat:-1})}attemptMove(){if(this.isMoving)return;let e=this.gridX,t=this.gridY;"horizontal"===this.moveDirection?(e+=this.currentDirection,this.setFlipX(this.currentDirection<0)):t+=this.currentDirection,this.canMoveTo(e,t)?this.moveToGrid(e,t):this.currentDirection*=-1}canMoveTo(e,t){if(e<0||e>=this.levelData[0].length||t<0||t>=this.levelData.length)return!1;const s=this.levelData[t][e],i=this.scene.player,r=i&&i.getBombs().some((s=>s.getGridX()===e&&s.getGridY()===t)),a=this.scene.level.hasCrateAt(e,t);return 1===s&&!r&&!a}moveToGrid(e,t){this.isMoving=!0,this.gridX=e,this.gridY=t;const s=16*e+8,i=16*t+8;this.moveTween=this.scene.tweens.add({targets:this,x:s,y:i,duration:.8*this.moveDelay,ease:"Power2",onComplete:()=>{this.isMoving=!1,this.scene&&this.checkPlayerCollision()}})}checkPlayerCollision(){const e=this.scene.player;e&&e.getGridX()===this.gridX&&e.getGridY()===this.gridY&&this.scene.events.emit("player-hit")}update(){this.isMoving||this.checkPlayerCollision()}destroy(e){this.moveTween&&(this.moveTween.stop(),this.moveTween=null),this.moveTimer&&this.moveTimer.destroy(),this.setTint(16711680),this.addBloodEffect(e)}addBloodEffect(e){const t=[9109504,14423100,11674146];for(let s=0;s<4;s++){const s=this.scene.add.rectangle(this.x+8*(Math.random()-.5),this.y+8*(Math.random()-.5),8,8,t[Math.floor(Math.random()*t.length)]);this.scene.tweens.add({targets:s,x:s.x+30*(Math.random()-.5),y:s.y+30*(Math.random()-.5),alpha:{from:1,to:0},scale:{from:1,to:0},duration:1e3+200*Math.random(),ease:"Power2.easeOut",onComplete:()=>{super.destroy(e),s.destroy()}})}}getGridX(){return this.gridX}getGridY(){return this.gridY}isAtPosition(e,t){return this.gridX===e&&this.gridY===t}onDestroy(){this.destroy()}}class m{static getLevel(e){return this.levels.find((t=>t.id===e))}static getLevelCount(){return this.levels.length}static getAllLevels(){return this.levels}}t(m,"levels",[{id:1,name:"Level 1",data:[[4,4,4,4,85,70,70,70,70,70,70,70,70,85],[4,4,4,4,85,1,1,2,1,1,2,1,1,85],[4,4,4,4,85,1,70,1,70,70,1,70,1,85],[4,4,4,4,85,2,1,1,1,1,1,1,2,85],[4,4,4,4,85,1,70,2,70,70,2,70,1,85],[4,4,4,4,85,1,2,1,1,1,1,2,1,85],[4,4,4,4,85,2,70,2,70,70,2,70,2,85],[4,4,4,4,85,1,2,1,1,1,1,2,1,85],[4,4,4,4,85,1,2,1,1,1,1,2,1,85],[4,4,4,4,70,70,70,70,70,70,70,70,70,70]],playerStartX:5,playerStartY:1,enemies:[{x:7,y:3,type:"horizontal"},{x:10,y:5,type:"horizontal"},{x:7,y:7,type:"vertical"},{x:12,y:5,type:"vertical"}],winCondition:{description:"Defeat all enemies",check:e=>e.enemies&&0===e.enemies.length}},{id:2,name:"Level 2",data:[[70,70,70,70,70,70,70,70,70,70,70,70,70,70],[85,1,1,1,1,70,1,1,70,1,1,1,1,85],[85,1,70,2,1,1,1,1,1,1,2,70,1,85],[85,1,2,1,70,1,70,70,1,70,1,2,1,85],[85,1,1,1,1,1,1,1,1,1,1,1,1,85],[85,70,1,70,1,70,2,2,70,1,70,1,70,85],[85,1,1,1,1,1,1,1,1,1,1,1,1,85],[85,1,2,1,70,1,70,70,1,70,1,2,1,85],[85,1,70,2,1,1,1,1,1,1,2,70,1,85],[70,70,70,70,70,70,70,70,70,70,70,70,70,70]],playerStartX:1,playerStartY:1,enemies:[{x:5,y:2,type:"horizontal"},{x:8,y:4,type:"vertical"},{x:3,y:6,type:"horizontal"},{x:11,y:6,type:"vertical"},{x:6,y:7,type:"horizontal"}],winCondition:{description:"Destroy all breakable blocks",check:e=>{if(!e.level||!e.level.layer)return!1;const t=e.level.layer;for(let s=0;s<t.height;s++)for(let e=0;e<t.width;e++){const i=t.getTileAt(e,s);if(i&&2===i.index)return!1}return!0}}}]);class p extends r.Scene{constructor(){super("Game"),t(this,"camera"),t(this,"background"),t(this,"player"),t(this,"level"),t(this,"enemies"),t(this,"isGameOver",!1),t(this,"currentLevelId",1)}init(e){this.currentLevelId=e.levelId||1}preload(){this.load.spritesheet("player","assets/spritesheet.png",{frameWidth:16,frameHeight:16}),this.load.spritesheet("enemy","assets/spritesheet.png",{frameWidth:16,frameHeight:16}),this.load.image("tiles","assets/spritesheet.png")}create(){this.camera=this.cameras.main,this.camera.setBackgroundColor(0),this.background=this.add.image(512,384,"background"),this.background.setAlpha(.5),this.loadLevel(this.currentLevelId),this.setupEventListeners()}loadLevel(e){const t=m.getLevel(e);t?(this.level&&(this.player&&this.player.destroy(),this.enemies.forEach((e=>e.destroy())),this.enemies=[]),this.level=new c(this,t),this.level.create(),this.player=new l(this,t.playerStartX,t.playerStartY,this.level.getLevelData()),this.enemies=[],t.enemies.forEach((e=>{this.enemies.push(new g(this,e.x,e.y,this.level.getLevelData(),e.type))})),this.isGameOver=!1,this.checkLevelComplete()):console.error(`Level ${e} not found!`)}checkLevelComplete(){const e=m.getLevel(this.currentLevelId);e?this.time.addEvent({delay:500,loop:!0,callback:()=>{e.winCondition.check(this)&&this.onLevelComplete()}}):console.error(`Level ${this.currentLevelId} not found!`)}onLevelComplete(){this.add.text(this.scale.width/2,this.scale.height/2,"Level Complete!",{fontSize:"32px",color:"#ffffff"}).setOrigin(.5),this.time.delayedCall(2e3,(()=>{const e=this.currentLevelId+1;e<=m.getLevelCount()?this.scene.restart({levelId:e}):this.scene.start("Victory")}))}setupEventListeners(){this.events.on("bomb-exploded",((e,t)=>{this.camera.shake(500,.01),this.player.removeBomb(e,t)})),this.events.on("enemy-hit",(e=>{this.removeEnemy(e)})),this.events.on("player-hit",(()=>{this.isGameOver||(this.isGameOver=!0,this.player.setTint(16711680),this.camera.flash(500,255,0,0),this.time.delayedCall(1500,(()=>{this.scene.start("GameOver",{levelId:this.currentLevelId})})))}))}removeEnemy(e){const t=this.enemies.indexOf(e);t>-1&&(this.enemies.splice(t,1),e.onDestroy())}update(){this.player&&this.player.update()}shutdown(){this.events.off("bomb-exploded"),this.events.off("player-hit"),this.events.off("enemy-hit"),this.events.off("crate-destroyed"),this.enemies.forEach((e=>e.destroy())),this.enemies=[]}}class u extends r.Scene{constructor(){super("MainMenu"),t(this,"background"),t(this,"title"),t(this,"instructions")}create(){const e=this.scale.width/2,t=this.scale.height/2;this.background=this.add.image(0,0,"background"),this.title=this.add.text(e,t-16,"Blastbound",{fontFamily:"PressStart2P",fontSize:16,color:"#FFFFFF",stroke:"#000000",strokeThickness:4,align:"center"}).setOrigin(.5).setAlpha(0),this.instructions=this.add.text(e,t+20,"Press spacebar",{fontFamily:"PressStart2P",fontSize:8,color:"#FFFFFF",align:"center"}).setOrigin(.5).setAlpha(0),this.textAnimationAtStart(this.title,1e3),this.textAnimationAtStart(this.instructions,2e3),this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE).once("down",(()=>{this.scene.start("Game")}))}textAnimationAtStart(e,t){this.tweens.add({targets:e,alpha:1,duration:t,ease:"Power2"})}}class y extends r.Scene{constructor(){super("Preloader")}init(){this.add.image(512,384,"background"),this.add.rectangle(512,384,468,32).setStrokeStyle(1,16777215);const e=this.add.rectangle(282,384,4,28,16777215);this.load.on("progress",(t=>{e.width=4+460*t}))}preload(){this.load.setPath("assets"),this.load.image("logo","logo.png")}create(){this.scene.start("MainMenu")}}const v={type:r.AUTO,width:320,height:180,zoom:3,parent:"game-container",backgroundColor:"#028af8",pixelArt:!0,scene:[n,y,u,p,o]};document.addEventListener("DOMContentLoaded",(()=>{new r.Game({...v,parent:"game-container"})}));
